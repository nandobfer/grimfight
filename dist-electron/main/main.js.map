{"version":3,"file":"main.js","sources":["../../electron/assetRewrite.ts","../../electron/main.ts"],"sourcesContent":["// electron/assetRewrite.ts\nimport { app, session } from \"electron\"\nimport path from \"node:path\"\nimport fs from \"node:fs\"\nimport { pathToFileURL } from \"node:url\"\n\nexport const setupAssetRewrite = () => {\n    // We want this in *preview* (file:// + unpackaged) and *packaged*\n    // Only skip when the renderer is served via HTTP dev server.\n    // (That condition is handled in main.ts; we don't early-return here.)\n\n    // Where the renderer build lives:\n    // - preview: <project>/dist\n    // - packaged: <resources>/app/dist  (app.getAppPath() points to resources/app or app.asar)\n    const distDir = path.join(app.getAppPath(), \"dist\")\n    const assetsDir = path.join(distDir, \"assets\")\n\n    session.defaultSession.webRequest.onBeforeRequest({ urls: [\"file://*/*\"] }, (details, cb) => {\n        try {\n            const url = new URL(details.url)\n            // Requests like file:///assets/foo.png â†’ pathname === \"/assets/foo.png\"\n            if (url.pathname.startsWith(\"/assets/\")) {\n                const rel = url.pathname.slice(\"/assets/\".length)\n                const filePath = path.join(assetsDir, rel)\n                if (fs.existsSync(filePath)) {\n                    // Use pathToFileURL to avoid backslash issues on Windows\n                    cb({ redirectURL: pathToFileURL(filePath).toString() })\n                    return\n                }\n            }\n        } catch {\n            // fall through\n        }\n        cb({}) // no change\n    })\n}\n","import { app, BrowserWindow } from \"electron\"\nimport path from \"node:path\"\nimport { setupAssetRewrite } from \"./assetRewrite\"\n\nfunction createWindow() {\n    const win = new BrowserWindow({\n        width: 768,\n        height: 768,\n        webPreferences: {\n            preload: path.join(__dirname, \"../preload/preload.js\"),\n            webgl: true,\n        },\n        darkTheme: true,\n        fullscreen: true,\n        title: \"Grim Fight\",\n    })\n\n    // Dev vs Prod\n    const devUrl = process.env.ELECTRON_RENDERER_URL\n    if (devUrl) {\n        win.loadURL(devUrl)\n        // win.webContents.openDevTools({ mode: \"detach\" })\n    } else {\n        // file:// protocol (preview or packaged)\n        win.loadFile(path.join(__dirname, \"../../dist/index.html\"))\n    }\n}\n\napp.commandLine.appendSwitch(\"ignore-gpu-blocklist\")\napp.commandLine.appendSwitch(\"enable-gpu-rasterization\")\napp.commandLine.appendSwitch(\"enable-zero-copy\")\n\napp.whenReady().then(() => {\n    const usingFileProtocol = !process.env.ELECTRON_RENDERER_URL\n    if (usingFileProtocol) setupAssetRewrite()\n\n    createWindow()\n\n    app.on(\"activate\", () => {\n        if (BrowserWindow.getAllWindows().length === 0) createWindow()\n    })\n})\n\napp.on(\"window-all-closed\", () => {\n    if (process.platform !== \"darwin\") app.quit()\n})\n\napp.whenReady().then(() => {\n    console.log(\"GPU:\", app.getGPUFeatureStatus())\n})\n"],"names":["app","session","pathToFileURL","BrowserWindow"],"mappings":";;;;;AAMO,MAAM,oBAAoB,MAAM;AAQnC,QAAM,UAAU,KAAK,KAAKA,SAAAA,IAAI,WAAA,GAAc,MAAM;AAClD,QAAM,YAAY,KAAK,KAAK,SAAS,QAAQ;AAE7CC,WAAAA,QAAQ,eAAe,WAAW,gBAAgB,EAAE,MAAM,CAAC,YAAY,EAAA,GAAK,CAAC,SAAS,OAAO;AACzF,QAAI;AACA,YAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAE/B,UAAI,IAAI,SAAS,WAAW,UAAU,GAAG;AACrC,cAAM,MAAM,IAAI,SAAS,MAAM,WAAW,MAAM;AAChD,cAAM,WAAW,KAAK,KAAK,WAAW,GAAG;AACzC,YAAI,GAAG,WAAW,QAAQ,GAAG;AAEzB,aAAG,EAAE,aAAaC,SAAAA,cAAc,QAAQ,EAAE,SAAA,GAAY;AACtD;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ,QAAQ;AAAA,IAER;AACA,OAAG,CAAA,CAAE;AAAA,EACT,CAAC;AACL;AC/BA,SAAS,eAAe;AACpB,QAAM,MAAM,IAAIC,uBAAc;AAAA,IAC1B,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,gBAAgB;AAAA,MACZ,SAAS,KAAK,KAAK,WAAW,uBAAuB;AAAA,MACrD,OAAO;AAAA,IAAA;AAAA,IAEX,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,OAAO;AAAA,EAAA,CACV;AAGD,QAAM,SAAS,QAAA,IAAY;AAC3B,MAAI,QAAQ;AACR,QAAI,QAAQ,MAAM;AAAA,EAEtB,OAAO;AAEH,QAAI,SAAS,KAAK,KAAK,WAAW,uBAAuB,CAAC;AAAA,EAC9D;AACJ;AAEAH,SAAAA,IAAI,YAAY,aAAa,sBAAsB;AACnDA,SAAAA,IAAI,YAAY,aAAa,0BAA0B;AACvDA,SAAAA,IAAI,YAAY,aAAa,kBAAkB;AAE/CA,SAAAA,IAAI,UAAA,EAAY,KAAK,MAAM;AACvB,QAAM,oBAAoB,CAAC,QAAA,IAAY;AACvC,MAAI,kBAAmB,mBAAA;AAEvB,eAAA;AAEAA,eAAI,GAAG,YAAY,MAAM;AACrB,QAAIG,SAAAA,cAAc,cAAA,EAAgB,WAAW,EAAG,cAAA;AAAA,EACpD,CAAC;AACL,CAAC;AAEDH,SAAAA,IAAI,GAAG,qBAAqB,MAAM;AAC9B,MAAI,QAAQ,aAAa,SAAUA,UAAAA,IAAI,KAAA;AAC3C,CAAC;AAEDA,SAAAA,IAAI,UAAA,EAAY,KAAK,MAAM;AACvB,UAAQ,IAAI,QAAQA,SAAAA,IAAI,oBAAA,CAAqB;AACjD,CAAC;"}